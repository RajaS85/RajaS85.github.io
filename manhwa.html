<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manhwa Factory | Raja Sharma</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <div class="logo">RS.</div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#software">Software</a></li>
            <li><a href="manhwa.html">Manhwa Factory</a></li>
            <li><a href="index.html#content">Content</a></li>
        </ul>
    </nav>

    <header class="hero">
        <h1>Manhwa Factory</h1>
        <p>Post and read community stories in real-time.</p>
    </header>

    <section class="portfolio-section">
        <div class="card">
            <h3>Add a New Story</h3>
            <input type="text" id="storyTitle" placeholder="Story Title" style="width: 100%; margin-bottom: 15px; padding: 12px; background: #222; border: 1px solid #333; color: white;">
            
            <textarea id="storyText" oninput="updateCount()" placeholder="Write your story here..." rows="8" style="width: 100%; margin-bottom: 5px; padding: 12px; background: #222; border: 1px solid #333; color: white;"></textarea>
            
            <p id="charCount" style="font-size: 0.8rem; color: #888; margin-bottom: 15px;">Characters: 0 / 1000</p>
            
            <button class="btn" onclick="saveStory()">Post Story</button>
        </div>
    </section>

    <section class="portfolio-section">
        <h2>Community Stories</h2>
        <div id="storiesList" class="grid-container">
            </div>
    </section>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
      // YOUR NEWEST CONFIG FROM "MY SECOND PROJECT"
      const firebaseConfig = {
        apiKey: "AIzaSyC_zQZ6bMM-zgcvcmzIkfejYSE0Q4j8cUs",
        authDomain: "my-second-project-2afd0.firebaseapp.com",
        databaseURL: "https://my-second-project-2afd0.firebaseio.com",
        projectId: "my-second-project-2afd0",
        storageBucket: "my-second-project-2afd0.firebasestorage.app",
        messagingSenderId: "945694664287",
        appId: "1:945694664287:web:db01ec541a03906d831dea"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Update character count
      function updateCount() {
        const text = document.getElementById('storyText').value;
        const countDisplay = document.getElementById('charCount');
        countDisplay.innerText = `Characters: ${text.length} / 1000`;
        countDisplay.style.color = text.length > 1000 ? "#ff4d4d" : "#888";
      }

      // Save Story
      async function saveStory() {
        const title = document.getElementById('storyTitle').value;
        const text = document.getElementById('storyText').value;
        if(!title || !text) return alert("Please fill both boxes!");
        if(text.length > 1000) return alert("Story is too long!");

        try {
          await db.collection("stories").add({
            title: title,
            content: text,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          alert("Story Posted!");
          document.getElementById('storyTitle').value = "";
          document.getElementById('storyText').value = "";
          updateCount();
        } catch (e) {
          console.error("Error: ", e);
          alert("Error: Check your Firebase Rules!");
        }
      }

      // Read Stories in Real-Time
      db.collection("stories").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
        const list = document.getElementById('storiesList');
        list.innerHTML = "";
        snapshot.forEach((doc) => {
          const story = doc.data();
          const storyId = doc.id;
          list.innerHTML += `
            <div class="card">
              <h3>${story.title}</h3>
              <p>${story.content}</p>
              <button class="btn" style="background: #ff4d4d; margin-top: 10px;" onclick="deleteStory('${storyId}')">Delete</button>
            </div>`;
        });
      });

      // Delete Story with Password
      async function deleteStory(id) {
        const password = prompt("Enter Admin Password:");
        if (password === "Raja123") { // You can change this secret code
          await db.collection("stories").doc(id).delete();
          alert("Deleted!");
        } else {
          alert("Wrong password!");
        }
      }
    </script>
</body>
</html>
