<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manhwa Factory | Raja Sharma</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <div class="logo">RS.</div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#software">Software</a></li>
            <li><a href="manhwa.html">Manhwa Factory</a></li>
            <li><a href="index.html#content">Content</a></li>
        </ul>
    </nav>

    <header class="hero">
        <h1>Manhwa Factory</h1>
        <p>Post and read community stories in real-time.</p>
    </header>

    <section class="portfolio-section">
        <div class="card">
            <h3>Add a New Story</h3>
            <input type="text" id="storyTitle" placeholder="Story Title" style="width: 100%; margin-bottom: 15px; padding: 12px; background: #222; border: 1px solid #333; color: white;">
            <textarea id="storyText" placeholder="Write your story here..." rows="8" style="width: 100%; margin-bottom: 15px; padding: 12px; background: #222; border: 1px solid #333; color: white;"></textarea>
            <button class="btn" onclick="saveStory()">Post Story</button>
        </div>
    </section>

    <section class="portfolio-section">
        <h2>Community Stories</h2>
        <div id="storiesList" class="grid-container">
            </div>
    </section>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
      // Your Firebase Config Object
      const firebaseConfig = {
        apiKey: "AIzaSyBZdapdPNVVdYyy5GEJJlQ7BTzyuzS6_YU",
        authDomain: "manhwa-factory.firebaseapp.com",
        projectId: "manhwa-factory",
        storageBucket: "manhwa-factory.firebasestorage.app",
        messagingSenderId: "63608154025",
        appId: "1:63608154025:web:d25a33904fd554f73686b8",
        measurementId: "G-KLZTG6PXTC"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Function to Save a New Story
      async function saveStory() {
        const title = document.getElementById('storyTitle').value;
        const text = document.getElementById('storyText').value;
        if(!title || !text) return alert("Please fill both boxes!");

        try {
          await db.collection("stories").add({
            title: title,
            content: text,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          alert("Story Posted!");
          document.getElementById('storyTitle').value = "";
          document.getElementById('storyText').value = "";
        } catch (e) {
          console.error("Error adding story: ", e);
        }
      }

      // Function to Pull Stories in Real-Time with Delete Button
      db.collection("stories").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
        const list = document.getElementById('storiesList');
        list.innerHTML = "";
        snapshot.forEach((doc) => {
          const story = doc.data();
          const storyId = doc.id;
          list.innerHTML += `
            <div class="card">
              <h3>${story.title}</h3>
              <p>${story.content}</p>
              <button class="btn" style="background: #ff4d4d; margin-top: 10px;" onclick="deleteStory('${storyId}')">Delete Story</button>
            </div>`;
        });
      });

      // Function to Delete with Secret Password
      async function deleteStory(id) {
        const password = prompt("Enter Admin Password to delete:");
        
        // Change "YourPassword123" to whatever you want your secret code to be
        if (password === "YourPassword123") { 
          if (confirm("Are you sure you want to remove this story?")) {
            try {
              await db.collection("stories").doc(id).delete();
              alert("Story deleted!");
            } catch (e) {
              alert("Delete failed. Check Firebase Rules.");
            }
          }
        } else {
          alert("Incorrect password!");
        }
      }
    </script>

</body>
</html>
